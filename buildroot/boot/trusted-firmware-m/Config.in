config BR2_TARGET_TRUSTED_FIRMWARE_M
	bool "TrustedFirmware-M (TF-M)"
	select BR2_TARGET_TFM_TESTS
	select BR2_TARGET_TFM_MBEDTLS
	select BR2_TARGET_TFM_MCUBOOT
	select BR2_TARGET_TFM_QCBOR
	select BR2_TARGET_TFM_CMSIS
	select BR2_HOST_CMAKE_AT_LEAST_3_21
	help
	  Enable this option if you want to build the TF-M for your
	  ARMv8 microcontroller.

	  https://git.trustedfirmware.org/TF-M/trusted-firmware-m.git

if BR2_TARGET_TRUSTED_FIRMWARE_M
choice
	prompt "TF-M Version"
	help
	  Select the specific TF-M version you want to use

config BR2_TARGET_TRUSTED_FIRMWARE_M_LATEST_VERSION
	bool "TF-Mv2.1.0"

config BR2_TARGET_TRUSTED_FIRMWARE_M_CUSTOM_VERSION
	bool "Custom version"
	select BR2_TARGET_TRUSTED_FIRMWARE_M_CUSTOM_3RD_PARTY
	help
	  This option allows to use a specific official versions

config BR2_TARGET_TRUSTED_FIRMWARE_M_CUSTOM_TARBALL
	bool "Custom tarball"
	select BR2_TARGET_TRUSTED_FIRMWARE_M_CUSTOM_3RD_PARTY

config BR2_TARGET_TRUSTED_FIRMWARE_M_CUSTOM_GIT
	bool "Custom Git repository"
	select BR2_TARGET_TRUSTED_FIRMWARE_M_CUSTOM_3RD_PARTY

endchoice

if BR2_TARGET_TRUSTED_FIRMWARE_M_CUSTOM_TARBALL

config BR2_TARGET_TRUSTED_FIRMWARE_M_CUSTOM_TARBALL_LOCATION
	string "URL of custom TF-M tarball"

endif

config BR2_TARGET_TRUSTED_FIRMWARE_M_CUSTOM_VERSION_VALUE
	string "TF-M version"
	depends on BR2_TARGET_TRUSTED_FIRMWARE_M_CUSTOM_VERSION

config BR2_TARGET_TRUSTED_FIRMWARE_M_VERSION
	string
	default "0c4c99ba33b3e66deea070e149279278dc7647f4" \
				if BR2_TARGET_TRUSTED_FIRMWARE_M_LATEST_VERSION
	default "custom"	if BR2_TARGET_TRUSTED_FIRMWARE_M_CUSTOM_TARBALL
	default BR2_TARGET_TRUSTED_FIRMWARE_M_CUSTOM_REPO_VERSION \
				if BR2_TARGET_TRUSTED_FIRMWARE_M_CUSTOM_GIT
	default BR2_TARGET_TRUSTED_FIRMWARE_M_CUSTOM_VERSION_VALUE \
				if BR2_TARGET_TRUSTED_FIRMWARE_M_CUSTOM_VERSION

if BR2_TARGET_TRUSTED_FIRMWARE_M_CUSTOM_GIT

config BR2_TARGET_TRUSTED_FIRMWARE_M_CUSTOM_REPO_URL
	string "URL of custom repository"

config BR2_TARGET_TRUSTED_FIRMWARE_M_CUSTOM_REPO_VERSION
	string "Custom repository version"
	help
	  Revision to use in the typical format used by Git
	  E.G. a sha id, a tag, ..

endif

menu "TF-M 3rd party projects"
config BR2_TARGET_TRUSTED_FIRMWARE_M_CUSTOM_3RD_PARTY
	bool "Use custom tarball for TF-M 3rd party projects"

source "boot/trusted-firmware-m/tfm-mbedtls/Config.in"
source "boot/trusted-firmware-m/tfm-mcuboot/Config.in"
source "boot/trusted-firmware-m/tfm-qcbor/Config.in"
source "boot/trusted-firmware-m/tfm-cmsis/Config.in"
source "boot/trusted-firmware-m/tfm-tests/Config.in"

endmenu

config BR2_TARGET_TRUSTED_FIRMWARE_M_PLATFORM
	string "TF-M platform path"
	help
	  Target plaform path to build for.

config BR2_TARGET_TRUSTED_FIRMWARE_M_ADDITIONAL_VARIABLES
	string "Additional TF-M build variables"
	help
	  Additional parameters for the TF-M build
	  E.G. '-DTFM_ISOLATION_LEVEL=2 -DTFM_PROFILE=large'

config BR2_TARGET_TRUSTED_FIRMWARE_M_DEBUG
	bool "Build in debug mode"
	help
	  Enable this option to build TF-M with -DCMAKE_BUILD_TYPE=Debug.

endif
